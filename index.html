<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>CromeCast Connect</title>
</head>

<script src="https://www.gstatic.com/cast/sdk/libs/receiver/2.0.0/cast_receiver.js">
</script>

<script type="text/javascript">
  
  var app_id = "1AA02BA5";
  var namespace = "urn:x-cast:com.example.chrome_send_world_2";
  
  function onError(){
  	var string = "Algo aconteceu";
        document.getElementById("Conexao").innerHTML = string.toString();
    }
  
  function onChannelOpened(event){
        var string = "onChannelOpened. Total number of channels: " + window.castReceiverManager.getSenders().length;
        document.getElementById("Conexao").innerHTML = string.toString();
    }
   
  function onChannelClosed(event){
  	if (window.castReceiverManager.getSenders().length == 0) window.close();
    }
    
  function onLoad(){
  	window.castReceiverManager = new cast.receiver.CastReceiverManager(window.castReceiverManager);
        window.castReceiverManager = cast.receiver.CastReceiverManager.getInstance();

        window.castReceiverManager.onSenderConnected = onChannelOpened;
        window.castReceiverManager.onSenderDisconnected = onChannelClosed;

        window.customMessageBus = window.castReceiverManager.getCastMessageBus(namespace);
        window.customMessageBus.onMessage = onMessage;

        window.castReceiverManager.start();

    	window.setInterval(onTimer, 2000);
  }
  
  function onMessage(event){
        var message = event.data;
        var senderId = event.senderId;
        document.getElementById("Conexao").innerHTML = "Entrou Aqui";
    }
    
  function onTimer(){
	    window.customMessageBus.broadcast("Hello");
  }
  
  window.addEventListener("load", onLoad);
</script>

<body>
    <center><i><b>Welcome to the jungle. We have fun and games.</b></i></center>
    <p></p>
    <form>
    	<button type="button" id="castme">Click To Cast</button>
    </form>
    <p></p>
    <p id="Conexao"></p>
</body>

</html>

